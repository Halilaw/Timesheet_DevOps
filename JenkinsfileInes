  pipeline 
   {
   environment {
		registry = "devops"
		registryCredential = 'ines18'
		dockerImage = '' }
		
         agent any
stages {
      stage("Cloning Project") {
      steps {
      git branch: 'ines', url: 'https://github.com/Halilaw/Timesheet_DevOps.git'
            }}
              stage("Building") {
       steps {
       
       bat "mvn clean install"
             }}

      stage("Unit tests with JUnit") {
       steps {
       
       bat "mvn test"
             }}
    
	  stage("Static Tests with sonar") {
       steps{
		bat "mvn sonar:sonar "		
			}}
	  stage ("Cleaning &Packaging") {    
       steps {
         bat "mvn clean package "
			}}

      stage("Deploying Artefact with Nexus") {
      steps {
       bat "mvn deploy"
			}}
		
	  stage('Building our image from dockerfile') {
			steps {
			script {
				bat " docker logout "
				bat " docker login -u ines18 -p ines123456 "
				bat "docker build -t devops ."
				bat "docker tag devops  ines18/devops:1" }}}
	stage('Deploying our image to dockerhub') {
			steps { 
			script  {
				bat " docker logout "
				bat " docker login -u ines18 -p ines123456 "
		 		bat "docker push  ines18/devops:1"
					}
				 }
			}
		}
	}
	